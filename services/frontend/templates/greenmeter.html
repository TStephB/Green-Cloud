{% extends 'base.html' %}

{% block content %}
<div class="container">
  <h1 class="mb-4"><i class="fas fa-leaf me-2"></i>GreenMeter</h1>

  <!-- Raspberry Pi Energy Overview -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <i class="fas fa-microchip me-2"></i>Raspberry Pi Energy Profile
    </div>
    <div class="card-body">
      <div class="row">
        <!-- Power Consumption -->
        <div class="col-md-4 text-center">
          <h3><i class="fas fa-bolt me-2"></i>Power Usage</h3>
          <h2 class="display-4">{{ data.power_usage|default('3.5') }} W</h2>
          <p class="text-muted">Current draw</p>
        </div>
        <!-- Energy Efficiency -->
        <div class="col-md-4 text-center">
          <h3><i class="fas fa-tachometer-alt me-2"></i>Efficiency</h3>
          <h2 class="display-4">{{ data.efficiency|default('92') }}%</h2>
          <p class="text-muted">Performance per watt</p>
        </div>
        <!-- Carbon Impact -->
        <div class="col-md-4 text-center">
          <h3><i class="fas fa-co2 me-2"></i>CO₂ Impact</h3>
          <h2 class="display-4">{{ data.carbon_footprint|default('0.002') }} kg</h2>
          <p class="text-muted">Per hour</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Detailed Power Analysis -->
  <div class="card">
    <div class="card-header bg-success text-white">
      <i class="fas fa-chart-line me-2"></i>Power Analysis
    </div>
    <div class="card-body">
      <div class="row">
        <!-- CPU Load Impact -->
        <div class="col-md-6">
          <h4><i class="fas fa-microchip me-2"></i>CPU Load Impact</h4>
          <div class="progress mb-3">
            <div class="progress-bar bg-info" role="progressbar"
                 style="width: {{ data.cpu_load|default('35') }}%"
                 aria-valuenow="{{ data.cpu_load|default('35') }}"
                 aria-valuemin="0"
                 aria-valuemax="100"></div>
          </div>
          <p class="small text-muted">
            Current CPU load: {{ data.cpu_load|default('35') }}%<br>
            Power draw: {{ data.cpu_power|default('1.2') }} W
          </p>
        </div>
        <!-- Thermal Efficiency -->
        <div class="col-md-6">
          <h4><i class="fas fa-temperature-low me-2"></i>Thermal Efficiency</h4>
          <div class="progress mb-3">
            <div class="progress-bar bg-warning" role="progressbar"
                 style="width: {{ data.temp_efficiency|default('75') }}%"
                 aria-valuenow="{{ data.temp_efficiency|default('75') }}"
                 aria-valuemin="0"
                 aria-valuemax="100"></div>
          </div>
          <p class="small text-muted">
            Current temp: {{ data.temperature|default('45') }}°C<br>
            Fan speed: {{ data.fan_speed|default('40') }}%
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js for Visualizations -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Power Usage Chart
    const powerCtx = document.getElementById('powerChart').getContext('2d');
    new Chart(powerCtx, {
      type: 'line',
      data: {
        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
        datasets: [{
          label: 'Power Usage (W)',
          data: [3.2, 3.1, 3.0, 2.9, 2.8, 2.9, 3.1, 3.3, 3.5, 3.6, 3.5, 3.4, 3.3, 3.4, 3.5, 3.6, 3.7, 3.6, 3.5, 3.4, 3.3, 3.2, 3.1, 3.0],
          borderColor: 'rgba(40, 167, 69, 1)',
          backgroundColor: 'rgba(40, 167, 69, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } }
      }
    });

    // Temperature vs Power Chart
    const tempCtx = document.getElementById('tempChart').getContext('2d');
    new Chart(tempCtx, {
      type: 'scatter',
      data: {
        datasets: [{
          label: 'Temperature vs Power',
          data: [
            {x: 35, y: 2.8},
            {x: 40, y: 3.0},
            {x: 45, y: 3.2},
            {x: 50, y: 3.5},
            {x: 55, y: 3.8}
          ],
          backgroundColor: 'rgba(220, 53, 69, 0.8)'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            title: { display: true, text: 'Temperature (°C)' }
          },
          y: {
            title: { display: true, text: 'Power Usage (W)' }
          }
        }
      }
    });
  });
</script>
{% endblock %}
